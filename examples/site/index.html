<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>Elm Digital Ocean API</title>
  <script type="text/javascript" src="port-webapp.js"></script>
</head>

<body>

<noscript>
<div style='width:40em; margin: 0 auto;text-align: center;'>
<p style='color: red; font-size: 200%; font-weight: bold;'>
  This site is generated by Elm JavaScript. If you're seeing this you have JavaScript disabled. Turn on JavaScript to make it work.
</p>
<p>
&copy; Copyright 2017 Bill St. Clair
&lt;<a href='mailto:billstclair@gmail.com'>billstclair@gmail.com</a>&gt;
<br/>
<a href='https://github.com/billstclair/elm-digital-ocean'><img src='images/GitHub-Mark-32px.png' alt='GitHub source code' width='32' height='32'/></a>
<a href='http://elm-lang.org/'><img src='images/elm-logo-125x125.png' alt='Elm inside' width='28' height='28'/></a>
</p>
</div>
</noscript>

<script type="text/javascript">

var elmDigitalOcean = {};

(function () {

  var propertiesName = 'elm-digital-ocean-properties';

  elmDigitalOcean.init = init;
  elmDigitalOcean.getProperties = getProperties;
  elmDigitalOcean.setProperties = setProperties;
  elmDigitalOcean.getProperty = getProperty;
  elmDigitalOcean.setProperty = setProperty;

  function getProperties() {
    var json = localStorage.getItem(propertiesName);
    return json ? JSON.parse(json) : {};
  }

  function setProperties(properties) {
    localStorage.setItem(propertiesName, JSON.stringify(properties));
  }

  // This isn't used by the Elm code, but is useful for debugging
  // in the JavaScript console.
  function getProperty(property) {
    var props = getProperties();
    return props[property];
  }

  function setProperty(property, value) {
    var props = getProperties();
    if (value == null) {
      delete props[property];
    } else {
      props[property] = value;
    }
    setProperties(props);
  }

  function init() {
    var alist = [];
    var properties = getProperties();
    for (key in properties) {
      alist.push([key, properties[key]]);
    };

    var webapp = Elm.DigitalOceanWebapp.fullscreen(alist);
    elmDigitalOcean.webapp = webapp;

    webapp.ports.setProperty.subscribe(function(pv) {
      setProperty(pv[0], pv[1])
    });

  }

})();

elmDigitalOcean.init();

</script>

</body>
</html>
